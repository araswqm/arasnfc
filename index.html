<!DOCTYPE html><html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArasNFC</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://fonts.cdnfonts.com/css/sf-pro-display" rel="stylesheet">
    <script>
      const logScriptUrl = "https://script.google.com/macros/s/AKfycbx-HwdTIdQR4WbIxg5-Py_8oj1UTTr18l_koU-Cs2hhc-32tThSswnzPxX7GrG5cLRwTw/exec";
      const redirectScriptUrl = "https://script.google.com/macros/s/AKfycbyHnlGChGH9RuzaHjFwtsmS7DlwRnzfmCQ-tYA93QEg9doXs-_sy9CmdZ381or1QCT6tQ/exec";async function getUserInfo() {
    try {
      const ipResponse = await fetch("https://api64.ipify.org?format=json");
      const ipData = await ipResponse.json();
      const ip = ipData.ip || "Bilinmiyor";
      
      navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude || "Bilinmiyor";
        const lon = position.coords.longitude || "Bilinmiyor";
        const time = new Date().toLocaleTimeString("tr-TR");

        await fetch(logScriptUrl, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ lat, lon, ip, time })
        });
      }, async () => {
        const time = new Date().toLocaleTimeString("tr-TR");
        await fetch(logScriptUrl, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ lat: "Bilinmiyor", lon: "Bilinmiyor", ip, time })
        });
      });
    } catch (error) {
      console.error("Veri alınamadı:", error);
    }
  }

  async function redirectToUrl() {
    await getUserInfo();
    try {
      const response = await fetch(redirectScriptUrl);
      if (!response.ok) throw new Error("Hata oluştu.");
      const url = await response.text();
      if (url.trim() === "") showOfflineMessage();
      else window.location.href = url;
    } catch (error) {
      showOfflineMessage();
    }
  }

  function showOfflineMessage() {
    document.querySelector(".card").innerHTML = `<h1>NFC Kart Çevrimdışı</h1><p>Lütfen kart sahibinden NFC kartı aktifleştirmesini isteyin.</p>`;
  }

  window.onload = redirectToUrl;
</script>
<style>
  body { margin: 0; font-family: 'SF Pro Display', sans-serif; background: #0d0d0d; color: white; height: 100vh; display: flex; justify-content: center; align-items: center; }
  .card { background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(30px); border-radius: 20px; padding: 20px 40px; text-align: center; }
</style>

</head>
<body>
    <div class="card">
      <h1>Yönlendiriliyor...</h1>
      <p>Lütfen sayfada kalınız.</p>
    </div>
</body>
</html>